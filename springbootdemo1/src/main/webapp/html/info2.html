<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>长治数据上报综合管理系统</title>
    <link rel="stylesheet" href="../css/layui.css">
    <link href="../css/main.css">
</head>

<body onload="cd();">
<div class="layui-layout layui-layout-admin">
    <div class="layui-header layui-bg-black">
        <div class="layui-row layui-col-md10">
            <h1 align="center" class="title-index" style="float: left;">&nbsp;<i
                    class="layui-icon layui-icon-template-1"></i>&nbsp;长治数据上报综合管理系统
            </h1>
        </div>
        <!--<div class="layui-row layui-col-md7">
            <ul class="layui-nav">
                <li class="layui-nav-item"><a href="info.html"></a></li>
                <li class="layui-nav-item"><a href="wodemianban.html"></a></li>
                <li class="layui-nav-item"><a href="xitongshezhi.html"></a></li>
                <li class="layui-nav-item"><a href="daimashengcheng.html"></a></li>
            </ul>
        </div>-->
        <div class="layui-row layui-col-md2" id="loginusername" style="float: left;">
            <!-- <a href="" style="color: white;margin: auto;position:relative" class="title-index">退出</a>-->
            <ul class="layui-nav">
                <div class="pagefix">
                    <li class="layui-nav-item">
                        <!--<a href=""><img src="//t.cn/RCzsdCq" class="layui-nav-img">我</a>-->
                        <a href=""><i class="layui-icon layui-icon-user" style="font-size: 16px;"></i>&nbsp;我</a>
                        <dl class="layui-nav-child">
                            <dd><a href="javascript:;">修改信息</a></dd>
                            <dd><a href="javascript:;">退了</a></dd>
                        </dl>
                    </li>
                </div>
            </ul>
        </div>
    </div>

    <div class="layui-side layui-bg-black diy3">
        <ul class="layui-nav layui-nav-tree" lay-filter="test" id="dtcd">

        </ul>

    </div>

    <div class="bstyle">
        <div class="layui-body">

            <div class="layui-tab">
                <ul class="layui-tab-title">
                    <li class="layui-this">工程技术研究中心</li>
                    <li>工程技术研究添加</li>
                </ul>
                <div class="layui-tab-content">
                    <div class="layui-tab-item layui-show">

                        <div class="layui-col-md12">


                            <div class="layui-form-item box1">
                                <form id="" method="post" class="layui-form layui-form-pane">
                                    <div class="layui-inline">
                                        <label class="layui-form-label cxlable">认定年份:</label>
                                        <div class="layui-input-inline colformstyle"
                                             style="width: 200px; line-height: 30px">
                                            <input type="text" name="" autocomplete="off"
                                                   class="layui-input colformstyle rdnf" id="rdnf">
                                        </div>
                                    </div>
                                    <div class="layui-inline">
                                        <label class="layui-form-label cxlable">名称:</label>
                                        <div class="layui-input-inline colformstyle" style="width: 200px;">
                                            <input type="text" name="" autocomplete="off"
                                                   class="layui-input colformstyle mc" id="mc">
                                        </div>
                                    </div>
                                    <div class="layui-inline">
                                        <label class="layui-form-label cxlable">运营主体:</label>
                                        <div class="layui-input-inline colformstyle" style="width: 200px;">
                                            <input type="text" name="" autocomplete="off"
                                                   class="layui-input colformstyle yyzt" id="yyzt">
                                        </div>
                                    </div>
                                    <button type="button" class="layui-btn layui-btn-normal layui-btn-sm" id="chaxun">查询
                                    </button>
                                    <button type="button" onclick="daochudaoru();"
                                            class="layui-btn layui-btn-primary layui-btn-sm">导入导出
                                    </button>
                                    <button type="button" class="layui-btn layui-btn-danger layui-btn-sm"
                                            id="piliangshanchu">批量删除
                                    </button>
                                </form>
                            </div>
                            <table id="xitongshezhit" lay-filter="xtsz" lay-data="{id:'reldata')"></table>
                        </div>

                        <div class="pagefix">
                            <div id="test1"></div>
                        </div>
                    </div>
                    <div class="layui-tab-item">

                        <form class="layui-form" action="" class="layui-form layui-form-pane">
                            <div class="layui-form-item">
                                <label class="layui-form-label">认证年份</label>
                                <div class="layui-input-block">
                                    <input type="text" class="layui-input tjform" id="rznf">
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <label class="layui-form-label">省级众创空间名称</label>
                                <div class="layui-input-block">
                                    <input type="text" name="title" required lay-verify="required" placeholder="请输入..."
                                           autocomplete="off" class="layui-input tjform">
                                </div>
                            </div>
                            <div class="layui-form-item ">
                                <label class="layui-form-label">运营主体</label>
                                <div class="layui-input-block">
                                    <input type="text" name="title" required lay-verify="required" placeholder="请输入..."
                                           autocomplete="off" class="layui-input tjform">
                                </div>
                            </div>
                            <div class="layui-form-item layui-form-text">
                                <label class="layui-form-label">备注信息</label>
                                <div class="layui-input-block">
                                    <textarea name="desc" placeholder="请输入内容" class="layui-textarea tjform"></textarea>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <div class="layui-input-block">
                                    <button class="layui-btn" lay-submit lay-filter="formDemo" onclick="test(data)">保存
                                    </button>
                                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                                </div>
                            </div>
                        </form>

                        <!--  <button type="button" class="layui-btn" id="shangchuan">
                              <i class="layui-icon">&#xe67c;</i>上传图片
                          </button>-->


                    </div>
                </div>
            </div>


        </div>
    </div>

    <!--  <div class="layui-footer">
          下边
          &lt;!&ndash; 底部固定区域 &ndash;&gt;
      </div>-->
</div>

<!--<script src="../js/layui.js"></script>-->
<script type="text/javascript" src="../js/jquery-1.8.0.min.js"></script>
<script src="../js/main.js"></script>
<!--引入lay-->
<script src="../js/layui.all.js"></script>


<!--依赖于lay的js-->
<script>
    //注意：选项卡 依赖 element 模块，否则无法进行功能性操作
    layui.use(['element', 'laypage', 'form', 'laydate', 'upload', 'table'], function () {
        element = layui.element;
        laypage = layui.laypage;
        var form = layui.form;
        var laydate = layui.laydate;
        var upload = layui.upload;
        var table = layui.table;


        laydate.render({
            elem: '#rznf'
            , change: function (value, date, endDate) {
                console.log(value); //得到日期生成的值，如：2017-08-18
                console.log(date); //得到日期时间对象：{year: 2017, month: 8, date: 18, hours: 0, minutes: 0, seconds: 0}
                console.log(endDate); //得结束的日期时间对象，开启范围选择（range: true）才会返回。对象成员同上。
            }
        });
        var uploadInst = upload.render({
            elem: '#shangchuan' //绑定元素
            , url: '/upload/' //上传接口
            , done: function (res) {
                //上传完毕回调
            }
            , error: function () {
                //请求异常回调
            }
        });
        var tableins = table.render({
                elem: '#xitongshezhit'
                //, toolbar: '#titleTpl'
                , tool: "#titleTpl"
                , toolbar: false
                , height: 500
                , width: 1300
                , even: true
                , url: '/api/zckj' //数据接口
                , page: true //开启分页
                , done: function (res, curr, count) {
                    console.log(res);
                    console.log(curr);
                    console.log(count);
                }
                , method: 'post'
                , contentType: 'application/json'
                , request: {
                    pageNum: 1 //页码的参数名称，默认：page
                    , pageSize: 10 //每页数据量的参数名，默认：limit
                    , yyzt: '',
                    mc: '',
                    rdnf: ''
                }
                , cols: [[ //表头
                    {field: 'id', title: 'ID', sort: true, fixed: 'left', align: 'center', type: 'checkbox'}
                    //, {checkbox: true, align: 'center'}
                    , {field: 'mode_name', title: '用户名', align: 'center'}
                    , {field: 'updatedate', title: '更新时间', sort: true, align: 'center'}
                    , {field: 'yyzt', title: '名称', align: 'center'}
                    , {field: 'caozuo', title: '操作', templet: '#titleTpl', align: 'center'}
                ]]
            })
        ;

        //查询
        $("#chaxun").click(function () {
            tableins.reload({
                where: {rdnf: $("#rdnf").val(), mc: $("#mc").val(), yyzt: $("#yyzt").val(), pageNum: 1, pageSize: 10},
                page: {
                    curr: 1 //重新从第 1 页开始
                }
            });
        });

        //批量删除
        $("#piliangshanchu").click(function () {
            var checkdatas = table.checkStatus('xitongshezhit').data;
            if (checkdatas.length == 0) {
                layer.msg("请选中你要删除的数据");
            } else {
                var ids = [];
                for (var i in checkdatas) {
                    ids.push(checkdatas[i].id);//获取数组中的id
                }

                layer.confirm('是否删除', {icon: 3, title: '消息'}, function (index) {
                    //传入后台
                    $.ajax({
                        type: "post",
                        contentType: 'application/json',
                        dataType: "json",
                        url: "/api/deldatas",
                        data: JSON.stringify({ids: ids}),
                        success: function (data) {
                            if (data.isSuccess == true) {
                                //如果成功就显示数据
                                tableins.reload({
                                    where: {rdnf: null, mc: null, yyzt: null, pageNum: 1, pageSize: 10}, page: {
                                        curr: 1 //重新从第 1 页开始
                                    }
                                });
                                layer.alert('删除成功', {icon: 1});
                            } else {
                                layer.alert('删除失败', {icon: 2});
                            }
                        },
                        error: function () {
                            alert(data.errorMessage);
                        }
                    });
                });

            }
        });

        //删除
        table.on('tool(xtsz)', function (obj) {
            var layEvent = obj.event;
            var data = obj.data; //获得当前行数据
            var u = "/api/deldataByid";
            if (layEvent == 'delete') {

                layer.confirm('是否删除', {icon: 3, title: '消息'}, function (index) {
                    var ms = delthis(data.id, u);
                    tableins.reload({
                        where: {rdnf: null, mc: null, yyzt: null, pageNum: 1, pageSize: 10}, page: {
                            curr: 1 //重新从第 1 页开始
                        }
                    });
                    //table.reload("xitongshezhit", {});
                    layer.alert('删除成功', {icon: 1});
                });
            } else {
                //layer.alert('删除失败', {icon: 2});
                layer.open({
                    type: 1,
                    content: $("#editxinxi").html(),
                    title: '修改数据',
                    area: ['500px', '300px']
                });
            }
            //填充表单
            form.val("edit-filter-form", {
                "mode_name": data.mode_name // "name": "value"
                , "updatedate": data.updatedate
                , "yyzt": data.yyzt,
                "id": data.id
            })
            //提交表单
            form.on('submit(but-submit)', function (data) {
                /*    console.logs("elem" + data.elem) //被执行事件的元素DOM对象，一般为button对象
                    console.logs("form" + data.form) //被执行提交的form对象，一般在存在form标签时才会返回
                    console.logs("field" + data.field) //当前容器的全部表单字段，名值对形式：{name: value}
                    console.logs("mode_name" + data.field.mode_name)*/
                var subeditd = data.field;
                $.ajax({
                    type: "post",
                    contentType: 'application/json',
                    dataType: "json",
                    url: "/api/editdata",
                    //data: $('#formajax').serialize(),
                    data: JSON.stringify({
                        rdnf: subeditd.mode_name,
                        id: subeditd.id,
                        mc: subeditd.updatedate,
                        yyzt: subeditd.yyzt
                    }),
                    success: function (data) {
                        if (data.isSuccess == true) {
                            layer.closeAll();
                            tableins.reload({
                                where: {rdnf: null, mc: null, yyzt: null, pageNum: 1, pageSize: 10}, page: {
                                    curr: 1 //重新从第 1 页开始
                                }
                            });
                            layer.alert('修改成功', {icon: 1});
                        } else {
                            layer.alert('修改失败', {icon: 2});
                        }
                    },
                    error: function () {
                        alert(data.errorMessage);
                    }
                });
                return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
            });
        });

        element.render();
    });


</script>

<script type="text/html" id="titleTpl">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="delete"><i class="layui-icon layui-icon-delete"/>删除</button>
        <button class="layui-btn layui-btn-sm" lay-event="update"><i class="layui-icon layui-icon-edit"/>编辑</button>
    </div>

</script>
<script type="text/html" id="editxinxi">
    <form class="layui-form layui-form-pane" action="" lay-filter="edit-filter-form">
        <div class="layui-form-item">
            <label class="layui-form-label">名称</label>
            <div class="layui-input-block">
                <input type="text" name="mode_name" required lay-verify="required" placeholder="请输入标题"
                       autocomplete="off"
                       class="layui-input">
                <input type="hidden" name="id">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">名称1</label>
            <div class="layui-input-block">
                <input type="text" name="updatedate" required lay-verify="required" placeholder="请输入标题"
                       autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">名称2</label>
            <div class="layui-input-block">
                <input type="text" name="yyzt" required lay-verify="required" placeholder="请输入标题" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" lay-submit lay-filter="but-submit">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
    </form>
</script>
<style>
    .title-index {
        line-height: 60px;
    }
    .tjform {
        width: 400px;
    }

    .cxlable {
        line-height: 30px;
        font-size: 13.5px;
        text-align: center;
    }

    .box1 {
        display: flex;
        justify-content: center;
    }

    .pagefix {
        float: right;
        margin-right: 20px;
    }

    .bstyle {
        margin-right: 20px;
    }
</style>
</body>
</html>
